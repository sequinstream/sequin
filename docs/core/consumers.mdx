---
title: Consumers
---

**Consumers** are central to Sequin. A consumer is how workers in your system receive messages. Using consumers allow you to:

- Filter the message stream down to what a given worker/system cares about
- Safely process messages concurrently
- Ensure messages are processed exactly once

To add a consumer to Sequin, run:

```bash
sequin consumer add [<stream>] [<consumer>] [<flags>]
```

For example:

```bash
# Create a consumer for all orders in the system
sequin consumer add mystream mycon --ack-wait-ms=60000 --filter="orders.>"
```

The flags:

```bash
  --ack-wait-ms=ACK-WAIT-MS          Acknowledgement wait time in milliseconds
  --max-ack-pending=MAX-ACK-PENDING  Maximum number of pending acknowledgements
  --max-deliver=MAX-DELIVER          Maximum number of delivery attempts
  --filter=FILTER                    Key pattern for message filtering
  --defaults                         Use default values for non-required fields
```

When no flags are provided, the CLI will walk you through setup.

## Consumer basics

Below are some of the most common consumer actions. For a complete list of available consumer actions, see `sequin consumer --help`:

```bash
usage: sequin consumer <command> [<args> ...]

Consumer related commands

Subcommands:
  consumer ls       List consumers
  consumer add      Add a new consumer
  consumer info     Show consumer information
  consumer receive  Receive messages for a consumer
  consumer peek     Show messages for a consumer
  consumer ack      Ack a message
  consumer nack     Nack a message
  consumer edit     Edit an existing consumer
  consumer rm       Remove a consumer

Global Flags:
  -h, --help             Show context-sensitive help
      --version          Show application version.
      --context=CONTEXT  Use a specific context
      --[no-]as-curl     Output the command as a curl request instead of executing it
```

### Receiving messages

To receive a message for a consumer, run:

```bash
sequin receive [<stream>] [<consumer>] [<flags>]
```

For example:

```bash
sequin receive mystream mycon --batch-size=10
```

Or, via HTTP:

```bash
curl 'https://[sequin-base-url]/api/streams/mystream/consumers/mycon/receive?batch_size=10'
```

After a batch of messages is delivered to your worker, those messages will not be available to other workers for that consumer for `ack-wait-ms`. Messages are delivered with an `ack_id` that your worker will [use to ack them](#acking-messages).

### Acking messages

After your system receives messages from a consumer, it will process them. When it's finished processing, it should ack those messages. Ack'ing ensures those messages will not be redelivered and is how Sequin guarantees exactly-once processing.

You ack messages using their `ack_id`. The `ack_id` for each message is included with every delivery.

Using the CLI:

```bash
sequin consumer ack [<stream>] [<consumer>] [<ack_id>]
```

When ack'ing via HTTP, you can include a batch of ack_ids to acknowledge all together:

```bash
curl -X POST -d '{"ack_ids":["ack_1jdiQuj"]}' -H 'Content-Type: application/json' 'https://[sequin-base-url]/api/streams/mystream/consumers/mycon/ack'
```

### Nacking messages

You can also "negative ack" or "nack" messages. This makes the messages available again for immediate redelivery.

Using the CLI:

```bash
sequin consumer nack mystream mycon [<ack_id>]
```

When nack'ing via HTTP, you can include a batch of ack_ids to nack all together:

```bash
curl -X 'POST' -d '{"ack_ids":["ack_1jdiQuj"]}' -H 'Content-Type: application/json' 'https://[sequin-base-url]/api/streams/mystream/consumers/mycon/nack'
```

Nacking is an advanced feature. Usually, it's fine to just let the `ack-wait-ms` for a message expire and have it be redelivered that way.

### Peeking messages

For debugging purposes, you can also "peek" at messages and their states for a consumer. Peeking lets you see the delivered messages and upcoming messages, without affecting their states.

You can peek via the CLI:

```bash
sequin consumer peek [<flags>] [<stream>] [<consumer>]
```

Or via HTTP:

```bash
curl -X 'GET' 'https://<sequin-base-url>/api/streams/<stream>/consumers/<consumer_name>/messages?limit=10&sort=seq_desc&visible=true'
```

### Observe

Use `sequin observe` to view messages flowing through a consumer in real-time:

```bash
sequin observe --stream=[<stream>] --consumer=[<consumer>]
```
